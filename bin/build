#!/bin/bash
set -e

# Install system dependencies for Playwright
apt-get update && apt-get install -y \
  libwoff1 \
  libopus0 \
  libwebp6 \
  libwebpdemux2 \
  libgudev-1.0-0 \
  libsecret-1-0 \
  libhyphen0 \
  libxslt1.1 \
  libevent-2.1-7 \
  libvpx5

# Set Playwright path
export PLAYWRIGHT_BROWSERS_PATH=/app/.playwright
mkdir -p $PLAYWRIGHT_BROWSERS_PATH

# Install Playwright
go install github.com/playwright-community/go-playwright@latest
go run github.com/playwright-community/go-playwright/cmd/playwright install --with-deps

# Build
go build -o bin/web -v .
